# Antigravity Skill Creator - 架构说明文档

> **版本**: 1.0
> **日期**: 2026-01-16
> **状态**: ✅ 已验证 (Score: 10.0/10)

---

## 1. 概述

**Antigravity Skill Creator** 是一个用于制作高质量 Antigravity Skill 的 Meta-Skill。它包含两个核心组件：

| 组件 | 类型 | 位置 | 用途 |
|:---|:---|:---|:---|
| **SKILL.md** | 技能定义 | `.agent/skills/antigravity-skill-creator/` | 告诉 Agent 何时触发、做什么 |
| **Workflow** | 执行流程 | `.agent/workflows/antigravity-skill-creator.md` | 定义 Agent 如何一步步执行任务 |

---

## 2. Skill 与 Workflow 的关系

### 2.1 职责分离

```
┌─────────────────────────────────────────────────────────────────┐
│                         用户请求                                 │
│        "帮我创建一个 code-review 的 Skill"                       │
└─────────────────────────────────────────────────────────────────┘
                                  │
                                  ▼
┌─────────────────────────────────────────────────────────────────┐
│                    Antigravity Agent                            │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │  读取 SKILL.md 的 description 字段                        │   │
│  │  匹配触发词: "create", "skill", "make a skill for..."    │   │
│  └─────────────────────────────────────────────────────────┘   │
└─────────────────────────────────────────────────────────────────┘
                                  │
                                  ▼
┌─────────────────────────────────────────────────────────────────┐
│                    SKILL.md (发现层)                            │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │  描述 Skill 的能力和触发条件                              │   │
│  │  引用 Related Workflow 进行实际执行                       │   │
│  └─────────────────────────────────────────────────────────┘   │
└─────────────────────────────────────────────────────────────────┘
                                  │
                                  ▼
┌─────────────────────────────────────────────────────────────────┐
│                 Workflow (执行层)                               │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │  Phase 0: intent-router (意图路由)                        │   │
│  │  Phase 1: requirement-collector / skill-parser           │   │
│  │  Phase 2: form-generator (表单生成)                       │   │
│  │  Phase 3: skill-builder (Skill 构建)                      │   │
│  │  Phase 4: skill-validator (质量验证)                      │   │
│  └─────────────────────────────────────────────────────────┘   │
└─────────────────────────────────────────────────────────────────┘
                                  │
                                  ▼
┌─────────────────────────────────────────────────────────────────┐
│                       输出                                      │
│           .agent/skills/{new-skill}/SKILL.md                   │
└─────────────────────────────────────────────────────────────────┘
```

### 2.2 核心原则

| 原则 | SKILL.md | Workflow |
|:---|:---|:---|
| **被动/主动** | 被动等待触发 | 主动执行流程 |
| **内容** | 描述性 (What/When) | 过程性 (How) |
| **粒度** | 概述 | 详细步骤 |
| **Token 效率** | < 5000 tokens | 不限 |

---

## 3. 目录结构

```
.agent/
├── skills/
│   └── antigravity-skill-creator/        # Meta-Skill
│       ├── SKILL.md                       # 技能定义
│       └── scripts/
│           ├── meta_init.py               # 初始化脚本
│           └── meta_validate.py           # 验证脚本
│
└── workflows/
    ├── antigravity-skill-creator.md       # 主工作流
    └── antigravity-skill-creator/         # 子 Agent
        ├── intent-router.md               # Phase 0: 意图路由
        ├── requirement-collector.md       # Phase 1A: 需求收集
        ├── skill-parser.md                # Phase 1B: Skill 解析
        ├── form-generator.md              # Phase 2: 表单生成
        ├── skill-builder.md               # Phase 3: Skill 构建
        └── skill-validator.md             # Phase 4: 质量验证
```

---

## 4. 数据流 (入仓出仓)

### 4.1 完整数据流图

```
┌──────────────────────────────────────────────────────────────────────────┐
│                              入仓 (INPUT)                                │
├──────────────────────────────────────────────────────────────────────────┤
│  入口 A: 用户自然语言描述                                                 │
│          "我想做一个 code-review 的 Skill"                                │
│                                                                          │
│  入口 B: 现有 Skill 文件/代码块                                           │
│          "把这个 Claude Skill 转成 Antigravity 格式: [代码]"              │
└──────────────────────────────────────────────────────────────────────────┘
                                    │
                                    ▼
┌──────────────────────────────────────────────────────────────────────────┐
│  Phase 0: intent-router                                                  │
│  ┌────────────────────────────────────────────────────────────────────┐ │
│  │ INPUT:  用户请求 (string)                                          │ │
│  │ OUTPUT: { intent: CREATE|REFACTOR, payload: 核心内容 }              │ │
│  └────────────────────────────────────────────────────────────────────┘ │
└──────────────────────────────────────────────────────────────────────────┘
                     │                              │
          intent=CREATE                    intent=REFACTOR
                     ▼                              ▼
┌────────────────────────────────┐  ┌────────────────────────────────────┐
│ Phase 1A: requirement-collector │  │ Phase 1B: skill-parser             │
│ ┌────────────────────────────┐ │  │ ┌────────────────────────────────┐ │
│ │ INPUT:  payload            │ │  │ │ INPUT:  payload (Skill 内容)   │ │
│ │ OUTPUT: 需求规格 (Markdown)│ │  │ │ OUTPUT: 重构清单 (Markdown)   │ │
│ │   - Name Candidate         │ │  │ │   - 合规性诊断                 │ │
│ │   - Draft Description      │ │  │ │   - 重构行动清单               │ │
│ │   - Detected Needs         │ │  │ └────────────────────────────────┘ │
│ └────────────────────────────┘ │  └────────────────────────────────────┘
└────────────────────────────────┘
                     │                              │
                     └──────────────┬───────────────┘
                                    ▼
┌──────────────────────────────────────────────────────────────────────────┐
│  Phase 2: form-generator                                                 │
│  ┌────────────────────────────────────────────────────────────────────┐ │
│  │ INPUT:  需求规格 OR 重构清单                                        │ │
│  │ OUTPUT: 配置表单 (Markdown 表格)                                    │ │
│  │   - name, description, has_scripts, has_references, has_assets     │ │
│  └────────────────────────────────────────────────────────────────────┘ │
└──────────────────────────────────────────────────────────────────────────┘
                                    │
                                    ▼
┌──────────────────────────────────────────────────────────────────────────┐
│  ⏸️ CHECKPOINT: 用户确认表单                                             │
│     - "确认" → 继续                                                      │
│     - "修改 [字段]" → 更新表单                                           │
└──────────────────────────────────────────────────────────────────────────┘
                                    │
                                    ▼
┌──────────────────────────────────────────────────────────────────────────┐
│  Phase 3: skill-builder                                                  │
│  ┌────────────────────────────────────────────────────────────────────┐ │
│  │ INPUT:  确认后的表单数据                                            │ │
│  │ TOOL:   可调用 meta_init.py 快速初始化                              │ │
│  │ OUTPUT: 完整的 Skill 目录                                           │ │
│  │   - .agent/skills/{name}/SKILL.md                                  │ │
│  │   - .agent/skills/{name}/scripts/ (可选)                           │ │
│  │   - .agent/skills/{name}/references/ (可选)                        │ │
│  │   - .agent/skills/{name}/assets/ (可选)                            │ │
│  └────────────────────────────────────────────────────────────────────┘ │
└──────────────────────────────────────────────────────────────────────────┘
                                    │
                                    ▼
┌──────────────────────────────────────────────────────────────────────────┐
│  Phase 4: skill-validator                                                │
│  ┌────────────────────────────────────────────────────────────────────┐ │
│  │ INPUT:  生成的 Skill 目录路径                                       │ │
│  │ TOOL:   调用 meta_validate.py 自动评分                              │ │
│  │ OUTPUT: 验证报告 (6维评分)                                          │ │
│  │   - 总分 >= 8.0 → 通过                                             │ │
│  │   - 总分 < 8.0 → 返回 Phase 3 修正 (最多 3 次)                     │ │
│  └────────────────────────────────────────────────────────────────────┘ │
└──────────────────────────────────────────────────────────────────────────┘
                                    │
                                    ▼
┌──────────────────────────────────────────────────────────────────────────┐
│                              出仓 (OUTPUT)                               │
├──────────────────────────────────────────────────────────────────────────┤
│  .agent/skills/{name}/                                                   │
│  ├── SKILL.md              # 符合 Antigravity 规范的技能定义             │
│  ├── scripts/              # Python 脚本 (支持 --help)                  │
│  ├── references/           # 参考文档                                    │
│  └── assets/               # 资产文件                                    │
└──────────────────────────────────────────────────────────────────────────┘
```

---

## 5. 脚本调用关系

### 5.1 meta_init.py

| 属性 | 值 |
|:---|:---|
| **位置** | `.agent/skills/antigravity-skill-creator/scripts/meta_init.py` |
| **调用者** | skill-builder (Phase 3) |
| **用途** | 快速初始化 Skill 目录结构 |
| **命令** | `python3 meta_init.py {name} --path .agent/skills` |

### 5.2 meta_validate.py

| 属性 | 值 |
|:---|:---|
| **位置** | `.agent/skills/antigravity-skill-creator/scripts/meta_validate.py` |
| **调用者** | skill-validator (Phase 4) |
| **用途** | 验证 Skill 并输出 6 维评分 |
| **命令** | `python3 meta_validate.py .agent/skills/{name}` |

---

## 6. 质量标准

### 6.1 六维评分体系

| 维度 | 权重 | 评分标准 |
|:---|:---|:---|
| **Frontmatter** | 20% | `name` 和 `description` 存在且格式正确 |
| **Name 规范** | 10% | 严格 Kebab Case: `^[a-z0-9]+(-[a-z0-9]+)*$` |
| **Description** | 30% | Trigger-First 格式，包含 WHEN + FOR |
| **结构清晰度** | 20% | 有 Overview/Protocols，无大段代码 |
| **资源分离** | 10% | 长代码在 scripts/，长文档在 references/ |
| **安全性** | 10% | 无危险命令 (`rm -rf`, `sudo rm`) |

### 6.2 通过标准

- **总分 >= 8.0**: ✅ 验证通过
- **总分 < 8.0**: ❌ 需修正 (最多迭代 3 次)
- **迭代 3 次后仍未通过**: ⚠️ 需人工审核

---

## 7. 路径规范

| 类型 | 路径 |
|:---|:---|
| **Workspace-specific** | `<workspace-root>/.agent/skills/<skill-name>/` |
| **Global** | `~/.gemini/antigravity/skills/<skill-name>/` |

---

## 8. 使用指南

### 8.1 通过对话触发

```
用户: 帮我创建一个 Python 测试生成的 Skill
Agent: [触发 antigravity-skill-creator workflow]
```

### 8.2 通过脚本直接使用

```bash
# 初始化新 Skill
python3 .agent/skills/antigravity-skill-creator/scripts/meta_init.py my-skill --path .agent/skills

# 验证 Skill
python3 .agent/skills/antigravity-skill-creator/scripts/meta_validate.py .agent/skills/my-skill
```

---

## 9. 修订记录

| 版本 | 日期 | 变更 |
|:---|:---|:---|
| 1.0 | 2026-01-16 | 初始版本 |
| 1.0.1 | 2026-01-16 | 修复路径规范 (`.antigravity/` → `.agent/`) |
| 1.0.2 | 2026-01-16 | 添加显式脚本调用说明到 skill-builder 和 skill-validator |
